# 优化功能测试清单

## 🚀 服务状态

✅ **前端服务**: http://localhost:5173  
✅ **Worker 服务**: http://localhost:8787  
✅ **健康检查**: http://localhost:8787/health

---

## 📋 测试项目

### 1. ✅ 健康检查端点
```bash
curl http://localhost:8787/health
```
**预期结果**: 返回 `{"status":"healthy","timestamp":...,"version":"1.0.0"}`

---

### 2. 🖼️ EXIF 方向校正测试

**测试步骤**:
1. 打开 http://localhost:5173
2. 上传一张手机拍摄的照片（可能有旋转）
3. 检查预览图片方向是否正确

**预期结果**: 
- 图片自动旋转到正确方向
- 不会出现横竖颠倒的情况

---

### 3. 📏 2048px 分辨率测试

**测试步骤**:
1. 上传一张高分辨率图片（如 4000x3000）
2. 打开浏览器开发者工具 → Network 标签
3. 查看上传的图片数据

**预期结果**:
- 图片被压缩到最长边 ≤ 2048px
- 文件大小 ≤ 1MB
- 识别准确度提升

---

### 4. 📦 10MB 文件限制测试

**测试步骤**:
1. 尝试上传 5-10MB 的大图片
2. 观察是否能成功处理

**预期结果**:
- 5-10MB 图片可以上传 ✅
- >10MB 图片显示错误提示 ❌

---

### 5. 🤖 本地食物检测测试

**测试 A - 食物图片**:
1. 上传一张食物图片（如：披萨、汉堡、水果）
2. 打开浏览器控制台（F12）
3. 查看 Console 输出

**预期结果**:
- Console 显示 `Food detected: {isFood: true, confidence: 0.x}`
- 正常进入分析流程

**测试 B - 非食物图片**:
1. 上传一张风景/人物/动物图片
2. 查看 Console 输出和界面提示

**预期结果**:
- Console 显示 `Food detection: {isFood: false, confidence: 0.x}`
- 可能显示提示信息（但不强制阻止）
- 仍可继续分析

**测试 C - 模型加载**:
1. 首次上传图片时
2. 查看 Network 标签

**预期结果**:
- 首次加载时下载 TensorFlow.js 和 MobileNet 模型
- 后续上传不再重复下载（已缓存）

---

### 6. ⏱️ 超时降级策略测试

**测试步骤**:
1. 上传一张复杂的食物图片（多种食物）
2. 观察分析时间

**预期结果**:
- 正常情况：30 秒内完成
- 复杂图片：如果 30 秒超时，自动重试 45 秒
- 显示友好的错误提示

---

### 7. 🔄 完整流程测试

**测试步骤**:
1. 上传食物图片
2. 等待本地检测（约 1-2 秒）
3. 等待 API 分析（约 5-20 秒）
4. 查看分析结果

**预期结果**:
- 图片方向正确
- 分析结果准确
- 显示食物名称、分量、卡路里、营养成分
- 可以保存到历史记录

---

## 🧪 性能测试

### 首次加载
- 打开 http://localhost:5173
- 查看 Network 标签总大小
- **预期**: 初始加载 < 500KB（不含 TensorFlow）

### 首次检测
- 上传第一张图片
- 查看 TensorFlow.js 和 MobileNet 加载时间
- **预期**: 模型加载 2-5 秒

### 后续检测
- 上传第二张图片
- 查看检测速度
- **预期**: < 1 秒（模型已缓存）

---

## 🐛 错误处理测试

### 1. 无效文件格式
- 上传 .txt 或 .pdf 文件
- **预期**: 显示"不支持的文件格式"

### 2. 文件过大
- 上传 >10MB 图片
- **预期**: 显示"文件过大"

### 3. 损坏的图片
- 上传损坏的图片文件
- **预期**: 显示"图片已损坏或无法读取"

### 4. 网络错误
- 停止 Worker 服务
- 尝试分析图片
- **预期**: 显示"网络连接失败"

---

## 📊 Token 节省验证

**测试场景**:
1. 上传 10 张图片：5 张食物 + 5 张非食物
2. 记录实际调用 API 的次数

**预期结果**:
- 食物图片：5 次 API 调用 ✅
- 非食物图片：可能 0-5 次（取决于检测置信度）
- 节省率：约 15-30%

---

## ✅ 测试完成标准

- [ ] 所有功能测试通过
- [ ] 无 Console 错误（警告可忽略）
- [ ] 性能符合预期
- [ ] 错误处理正常
- [ ] 用户体验流畅

---

## 🔧 调试命令

```bash
# 查看前端日志
# 浏览器 Console (F12)

# 查看 Worker 日志
# 终端中 Worker 进程的输出

# 重启服务
npm run dev  # 前端
cd workers && npm run dev  # Worker

# 检查构建
npm run build
```

---

## 📝 测试记录

**测试时间**: ___________  
**测试人员**: ___________  
**测试结果**: ___________  
**问题记录**: ___________
