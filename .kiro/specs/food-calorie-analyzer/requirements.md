# 需求文档

## 简介

食物卡路里分析系统是一个基于Web的应用程序，允许用户上传食物图片，系统通过集成方舟豆包1.6大模型来识别食物类型、计算卡路里含量并分析营养成分。该系统旨在帮助用户更好地了解饮食营养信息，支持健康饮食管理。

## 术语表

- **系统 (System)**: 食物卡路里分析Web应用程序
- **用户 (User)**: 使用该应用程序的最终用户
- **方舟豆包模型 (Ark Doubao Model)**: 字节跳动的方舟豆包1.6大语言模型API
- **食物识别 (Food Recognition)**: 通过图像识别技术识别食物类型的过程
- **营养成分 (Nutritional Information)**: 包括卡路里、蛋白质、脂肪、碳水化合物等营养数据
- **分析结果 (Analysis Result)**: 包含食物识别结果和营养成分信息的完整输出

## 需求

### 需求 1

**用户故事:** 作为用户，我希望能够上传食物图片，以便系统可以识别食物并分析其营养成分

#### 验收标准

1. WHEN 用户选择一张图片文件 THEN 系统 SHALL 验证文件格式为支持的图片类型（JPEG、PNG、WebP）
2. WHEN 用户上传的图片文件大小超过10MB THEN 系统 SHALL 拒绝上传并显示错误提示信息
3. WHEN 系统接收到有效图片 THEN 系统 SHALL 检测图片的分辨率和文件大小
4. WHEN 图片分辨率超过2048x2048像素 THEN 系统 SHALL 将图片压缩至合适尺寸以节省token消耗
5. WHEN 图片文件大小超过2MB THEN 系统 SHALL 在保持可识别质量的前提下压缩图片
6. WHEN 图片压缩完成 THEN 系统 SHALL 在界面上显示处理后的图片预览
7. WHEN 图片预处理完成 THEN 系统 SHALL 将优化后的图片数据发送至方舟豆包模型进行分析
8. WHEN 用户上传空文件或损坏的图片 THEN 系统 SHALL 拒绝处理并提示用户重新上传有效图片

### 需求 2

**用户故事:** 作为用户，我希望系统能够准确识别图片中的食物类型，以便我了解我吃的是什么

#### 验收标准

1. WHEN 系统接收到有效的食物图片 THEN 系统 SHALL 调用方舟豆包模型API识别图片中的食物类型
2. WHEN 方舟豆包模型返回识别结果 THEN 系统 SHALL 提取并显示食物名称
3. WHEN 图片中包含多种食物 THEN 系统 SHALL 列出所有识别到的食物类型
4. WHEN 图片中没有可识别的食物 THEN 系统 SHALL 提示用户图片中未检测到食物
5. WHEN API调用失败或超时 THEN 系统 SHALL 显示友好的错误信息并允许用户重试

### 需求 3

**用户故事:** 作为用户，我希望系统能够计算食物的卡路里含量，以便我管理每日热量摄入

#### 验收标准

1. WHEN 系统识别出食物类型 THEN 系统 SHALL 通过方舟豆包模型估算该食物的卡路里含量
2. WHEN 系统计算卡路里 THEN 系统 SHALL 以千卡（kcal）为单位显示结果
3. WHEN 图片中包含多种食物 THEN 系统 SHALL 分别显示每种食物的卡路里并计算总和
4. WHEN 系统无法准确估算卡路里 THEN 系统 SHALL 提供一个合理的范围值
5. WHEN 显示卡路里信息 THEN 系统 SHALL 标注这是基于标准份量的估算值

### 需求 4

**用户故事:** 作为用户，我希望查看食物的详细营养成分，以便我全面了解饮食营养

#### 验收标准

1. WHEN 系统识别出食物 THEN 系统 SHALL 显示蛋白质含量（克）
2. WHEN 系统识别出食物 THEN 系统 SHALL 显示脂肪含量（克）
3. WHEN 系统识别出食物 THEN 系统 SHALL 显示碳水化合物含量（克）
4. WHEN 系统识别出食物 THEN 系统 SHALL 显示膳食纤维含量（克）
5. WHEN 系统识别出食物 THEN 系统 SHALL 以结构化格式展示所有营养成分信息

### 需求 5

**用户故事:** 作为用户，我希望系统响应快速且界面友好，以便我获得良好的使用体验

#### 验收标准

1. WHEN 用户上传图片后 THEN 系统 SHALL 在3秒内显示加载状态指示器
2. WHEN 系统正在处理图片 THEN 系统 SHALL 显示处理进度或加载动画
3. WHEN 分析完成 THEN 系统 SHALL 以清晰易读的方式展示结果
4. WHEN 用户查看分析结果 THEN 系统 SHALL 提供"重新分析"或"上传新图片"的选项
5. WHEN 系统在移动设备上运行 THEN 系统 SHALL 保持响应式布局和良好的触摸交互

### 需求 6

**用户故事:** 作为用户，我希望能够查看历史分析记录，以便追踪我的饮食情况

#### 验收标准

1. WHEN 用户完成一次食物分析 THEN 系统 SHALL 将结果保存到本地存储
2. WHEN 用户访问历史记录页面 THEN 系统 SHALL 显示最近的分析记录列表
3. WHEN 显示历史记录 THEN 系统 SHALL 包含缩略图、食物名称、卡路里和分析时间
4. WHEN 用户点击历史记录项 THEN 系统 SHALL 显示该记录的完整营养分析详情
5. WHEN 用户删除历史记录 THEN 系统 SHALL 从本地存储中移除该记录并更新列表

### 需求 7

**用户故事:** 作为开发者，我希望能够安全地配置和管理API密钥，以便系统可以调用方舟豆包API服务

#### 验收标准

1. WHEN 系统部署时 THEN 系统 SHALL 从环境变量中读取方舟豆包API密钥
2. WHEN 系统启动时 THEN 系统 SHALL 验证API密钥是否已配置且格式有效
3. WHEN API密钥未配置 THEN 系统 SHALL 在日志中记录错误并拒绝启动
4. WHEN 系统存储API密钥 THEN 系统 SHALL 确保密钥不会出现在代码仓库或前端代码中
5. WHEN 系统使用API密钥 THEN 系统 SHALL 仅在后端服务器中访问密钥进行API调用

### 需求 8

**用户故事:** 作为开发者，我希望系统能够安全地集成方舟豆包API，以便保护用户数据和优化token使用

#### 验收标准

1. WHEN 系统调用方舟豆包API THEN 系统 SHALL 通过后端服务器发送请求而非直接从前端调用
2. WHEN 系统发送图片到API THEN 系统 SHALL 使用压缩后的图片以减少token消耗
3. WHEN 系统处理用户上传的图片 THEN 系统 SHALL 在分析完成后删除服务器上的临时文件
4. WHEN API请求失败 THEN 系统 SHALL 记录错误日志但不向用户暴露敏感信息
5. WHEN 系统传输图片数据 THEN 系统 SHALL 使用HTTPS协议确保数据传输安全

### 需求 9

**用户故事:** 作为用户，我希望系统能够处理各种图片质量和拍摄角度，以便在不同场景下都能使用

#### 验收标准

1. WHEN 用户上传低分辨率图片 THEN 系统 SHALL 检测分辨率并在结果中标注可能的准确度影响
2. WHEN 图片中食物被部分遮挡 THEN 系统 SHALL 基于可见部分进行识别并标注不确定性
3. WHEN 图片光线条件不佳 THEN 系统 SHALL 尝试识别并提示用户可能影响准确性
4. WHEN 图片包含非食物对象 THEN 系统 SHALL 过滤掉非食物项并仅显示食物相关结果
5. WHEN 系统检测到图片质量问题 THEN 系统 SHALL 提供改善建议给用户

### 需求 10

**用户故事:** 作为开发者，我希望系统能够部署到免费的托管平台，以便降低运营成本并便于参加编程竞赛

#### 验收标准

1. WHEN 系统架构设计完成 THEN 系统 SHALL 支持部署到GitHub Pages或Cloudflare Pages
2. WHEN 系统使用静态资源 THEN 系统 SHALL 确保所有前端资源可以通过静态托管服务访问
3. WHEN 系统需要后端服务 THEN 系统 SHALL 使用Serverless函数（如Cloudflare Workers或Vercel Functions）
4. WHEN 系统部署配置 THEN 系统 SHALL 提供自动化部署脚本或配置文件
5. WHEN 系统在免费平台运行 THEN 系统 SHALL 优化资源使用以符合免费额度限制
